# 5.模型训练与配置

## 5.1   训练选项卡概览

AI Matrix训练选项卡共分为模型配置、数据增强、训练参数、训练视图、训练仪表盘和图像评估画布六部分。如图5-1所示。其中需要用户配置的部分分别是模型配置、数据增强和训练参数这三部分。

![image-20240522174944403](http://photos.100ask.net/canaan-docs/image-20240522174944403.png)

图5-1 训练选项卡页面

1、模型配置栏：图5-1中的①号区域。用户可以在这里自定义的选择模型结构，模型大小，以及模型输入图像尺寸。

2、数据增强配置栏：图5-1中的②号区域。用户可以在这里根据所用数据集的特性配置数据增强方法。

3、训练参数配置栏：图5-1中的③号区域。用户可以在这里配置学习率、迭代轮数、训练批大小等参数。

4、训练视图：图5-1中的④号区域。在AI Matrix进入训练状态后，AI Matrix计算出的指标数据会以曲线的形式刷新到该区域。

5、训练仪表盘：图5-1中的⑤号区域。在AI Matrix进入到训练状态后，AI Matrix会动态的将训练状态、当前Epoch次数、迭代轮数等。在该区域用户可以自定义loss曲线的刷新步长。

6、图像评估画布：图5-1中的⑥号区域。在AI Matrix进入到训练状态后，AI Matrix会动态的输出模型在验证集上的评估结果。

如果用户对深度学习模型参数不熟悉，可以直接使用默认参数进行训练，单击开始训练按钮，AI Matrix会进入到训练状态，开始训练按钮变为停止训练按钮，用户可通过操作该按钮来控制AI Matrix的训练状态。如图5-2所示。

![image-20240522175000793](http://photos.100ask.net/canaan-docs/image-20240522175000793.png)

图5-2 AI Matrix训练过程

在训练过程中，训练视图会实时刷新训练指标曲线，同时仪表盘与图像评估画布也会实时同步更新。

## 5.2   模型配置

AI Matrix将深度学习的训练模块抽象为模型配置、数据增强、训练参数三部分。在模型配置部分用户可以根据不同的任务类型、不同的数据集来进行配置。

1、对于分类模型用户可以配置模型结构、是否使用预训练、模型宽度和图像尺寸。模型结构提供了can1、can2、can5、can6、can7、can8、can9，7种模型，用户可以选择任意的模型进行训练，如果在训练结束后想要断点续训，则选择update模型。如图5-3所示。

![image-20240522175009174](http://photos.100ask.net/canaan-docs/image-20240522175009174.png)

图5-3 分类模型参数配置

2、对于目标检测模型，用户在配置模型的前提下还可以配置backbone，这里的backbone部分复用了分类模型，目标检测任务AI Matrix按照是否使用anchor提供了AnchorBased检测器和AnchorFree检测器。根据训练过程使用的模型辅助训练策略提供了GFLDet检测模型，同时AI Matrix还提供了极简目标检测器FreeDet。如图5-4所示。

![image-20240522175020954](http://photos.100ask.net/canaan-docs/image-20240522175020954.png)

图5-4 目标检测模型参数

目标检测模型还支持不同模型大小和模型宽度因子供用户选择，这个两个选择分别控制着模型的深度和模型宽度。用户可根据自己的需要进行选择。

3、对于语义分割任务，AI Matrix提供了DeepNet和EDNet两种模型，其中DeepNet参数量较大，分割精度较高；EDNet模型参数量较少，分割速度较快，如图5-5所示：

![image-20240522175028970](http://photos.100ask.net/canaan-docs/image-20240522175028970.png)

图5-5 语义分割模型参数

注意：如果用户对模型配置参数陌生，可以直接使用默认参数。

## 5.3   数据增强

AI Matrix提供了一下数据增强方法，如表5-1所示

| 分类         | 检测       | 分割       |
| ------------ | ---------- | ---------- |
| 自动数据增强 | 亮度增强   | 亮度增强   |
| 亮度增强     | 对比度增强 | 对比度增强 |
| 对比度增强   | 饱和度增强 | 饱和度增强 |
| 饱和度增强   | 色度增强   | 色度增强   |
| 锐度增强     | 锐度增强   | 锐度增强   |
| 水平翻转     | 水平翻转   | 水平翻转   |
| 垂直翻转     | 垂直翻转   | 垂直翻转   |
| 旋转         |            | 随机缩放   |
|              |            | 随机裁剪   |

表5-1 不同类型任务增强方法

对于分类任务，用户可以直接使用自动数据增强方式来进行数据增强，其他任务需要数据集特点来进行合理数据增强。**注意：数据增强方式并不是开启的越多越好，过度的数据增强有可能会降低检测器的检测性能。**

## 5.4   训练参数

AI Matrix对不同的任务提供了不同的训练参数，不同任务之间可选择的任务参数不同，

1、分类任务可调参数：学习率、迭代轮数、训练批大小、优化器、损失函数、学习率调度、StepLR步长、GPU索引。

2、检测任务可调参数：在分类任务可调参数的基础上增加是否使用AutoAnchor、NMS置信度阈值、NMS交并比阈值、AMP混合精度、移动平均EMA、早挺策略ES、是否进行预热、多尺度训练等。如果在目标检测任务中使用AnchorBased检测器，可以使用AutoAnchor来自动对数据集进行Anchor计算，NMS置信度阈值与交并比阈值会影响输出框的数量，以及重叠框之间的抑制程度。

3、分割任务可调参数：在分类任务可调参数的基础上增加验证批大小、验证缩放设置和验证翻转设置。

注意：AI Matrix在只支持单卡训练，用户可以指定不同的显卡需要进行训练，默认的显卡序号为0。如图5-6所示：

![image-20240522175113842](http://photos.100ask.net/canaan-docs/image-20240522175113842.png)

图5-6 训练参数设置

 

 

